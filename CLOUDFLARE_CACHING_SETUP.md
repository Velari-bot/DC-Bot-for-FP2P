# How to Configure Caching (Firebase + Cloudflare)

You are using **Firebase Hosting** to serve your website. To get massive bandwidth savings, you need to put **Cloudflare** in front of it and ensure files are cached there, so you don't pay for Firebase data transfer.

## 1. Cloudflare DNS Setup
1.  **Add your site to Cloudflare**: Go to cloudflare.com, add your domain (`fortnitepathtopro.com`).
2.  **Update Nameservers**: Change your domain's nameservers at your registrar (GoDaddy, Namecheap, etc.) to the ones Cloudflare gives you.
3.  **Proxy Records**: In Cloudflare DNS settings, make sure the **Proxy status** is **Proxied** (Orange Cloud icon) for your root domain (`@`) and `www`.
    *   Target: Your Firebase Hosting IP or CNAME (usually `firebaseapp.com` alias).

## 2. Firebase Headers Config
To tell Cloudflare "It's safe to cache these files for a long time", you need to set headers in your `firebase.json` file.

**Add this to your `firebase.json`:**

```json
{
  "hosting": {
    "public": "build",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "headers": [
      {
        "source": "**/*.@(jpg|jpeg|gif|png|mp4|webm|m3u8|ts)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "public, max-age=31536000, s-maxage=31536000"
          }
        ]
      }
    ]
  }
}
```
*   `max-age`: Tells the browser to cache it.
*   `s-maxage`: Tells Cloudflare (CDNs) to cache it.
*   **Result**: Video chunks (`.ts`) and manifests (`.m3u8`) will be cached at the edge.

## 3. Cloudflare Page Rules (The "Force Cache" Switch)
Even with headers, sometimes different query strings or cookies prevent caching. Force it with a Page Rule.

1.  Go to **Rules > Page Rules** in Cloudflare.
2.  Create a strict caching rule for your video assets.
3.  **URL Pattern**: `*fortnitepathtopro.com/videos/*` (or wherever you put your HLS folders).
4.  **Settings**:
    *   **Cache Level**: `Cache Everything` (Crucial!)
    *   **Edge Cache TTL**: `1 Month`
5.  **Save and Deploy**.

## 4. Where to put the files?
For this caching to work easily with the setup above:
1.  Put your HLS folders (generated by the script) into your project's `public/videos/` folder (or `static/videos/` depending on your build).
2.  Deploy your site: `npm run build` and `firebase deploy`.

**Why this saves money:**
- **User A** watches the video. Request goes Cloudflare -> Firebase. You pay Firebase for ~100MB. Cloudflare saves a copy.
- **User B** watches the video. Request goes Cloudflare -> (Cached). **Zero request to Firebase.** You pay $0.
- **User C through Z**: Pay $0.

## Summary Checklist
- [ ] `npm install` (Running now...)
- [ ] Update `firebase.json` with headers.
- [ ] Configure Cloudflare "Cache Everything" rule.
- [ ] Upload HLS files to `public/videos` and deploy.
